<?xml version="1.0" standalone="yes"?>
<!-- $Id: testMCMC.xml,v 1.2 2005/07/11 23:22:40 rambaut Exp $ -->
<!-- Tests the MCMC engine -->

<beast>

    <parameter id="precision.offDiagonal" value="0.0 0.0 0.0 0.0 0.0 0.0" />

    <LKJCorrelationPrior id="precisionPrior" shapeParameter="2.0" dimension="4">
		<data>
            <parameter idref="precision.offDiagonal"/>
		</data>
	</LKJCorrelationPrior>

	<operators id="operators">

        <transformedParameterRandomWalkOperator windowSize="1.0" weight="1">
            <transformedMultivariateParameter>
                <parameter idref="precision.offDiagonal"/>
                <LKJTransform dimension = "4"/>
            </transformedMultivariateParameter>
        </transformedParameterRandomWalkOperator>
        <!-- <randomWalkOperator windowSize="1.0" weight="1"> -->
        <!--     <parameter idref="precision.offDiagonal"/> -->
        <!-- </randomWalkOperator> -->

	</operators>

	<mcmc id="mcmc" chainLength="60000000" autoOptimize="true">
        <posterior id="posterior">
        	<dummyLikelihood id="likelihood">
                <parameter idref="precision.offDiagonal"/>
            </dummyLikelihood>

            <prior id="prior">
                <LKJCorrelationPrior idref="precisionPrior"/>
                <!-- <multivariateWishartPrior idref="precisionPrior"/> -->
                <!-- <uniformPrior idref="uniformPrior"/> -->
            </prior>
        </posterior>

        <operators idref="operators"/>

		<log logEvery="100">
			<column label="posterior" dp="4" width="12">
				<likelihood idref="likelihood"/>
                <prior idref="prior"/>
			</column>
			<column label="Precision" dp="4" width="12">
                <matrixParameter idref="precision.offDiagonal"/>
			</column>
		</log>
		<log logEvery="100" fileName="testNormalModelCorrelation.log">
            <matrixParameter idref="precision.offDiagonal"/>
		</log>
	</mcmc>

	<report>
		<property name="timer">
			<object idref="mcmc"/>
		</property>
	</report>

</beast>

<!--
# Read log 
dat <- read_log(file = "testNormalModelCorrelation.log", burning = 0)

# Get observed moments
means <- get_mean(dat)
vars <- get_var(dat)

# Get theoretical moments (uniform on [a, b])
exp_th <- 0 # LKJ exp is Identity matrix

# var of a LKJ -> transformed beta
shape <- 2.0
dim <- 4
dim_offdiag <- dim * (dim - 1) / 2

var_th <- 1 / (2 * shape + dim - 1)

for (i in 1:(dim_offdiag)) {
  stopifnot(all.equal(pull(means, i), exp_th, tol = 0.001)) 
}

for (i in 1:(dim_offdiag)) {
  stopifnot(all.equal(pull(vars, i), var_th, tol = 0.001))
}
-->
