<?xml version="1.0" standalone="yes"?>
<beast>

    <taxa id="taxa">
        <taxon id="A">
            <attr name="X">10</attr>
        </taxon>
        <taxon id="B">
            <attr name="X">2</attr>
        </taxon>
        <taxon id="C">
            <attr name="X">3</attr>
        </taxon>
    </taxa>


    <!-- The sequence alignment (each sequence refers to a taxon above).         -->
    <!-- ntax=3 nchar=4                                                        -->
    <alignment id="alignment1" dataType="nucleotide">
        <sequence>
            <taxon idref="A"/>
            GAGG
        </sequence>
        <sequence>
            <taxon idref="B"/>
            GAGT
        </sequence>
        <sequence>
            <taxon idref="C"/>
            AAAT
        </sequence>
    </alignment>

    <!-- The unique patterns                                                     -->
    <!-- npatterns=3                                                            -->
    <patterns id="patterns1" from="1">
        <alignment idref="alignment1"/>
    </patterns>

    <newick id="tree">
		((A:0.6,B:0.6):0.7,C:1.3);
	</newick>

    <treeModel id="treeModel">
        <newick idref="tree"/>
        <rootHeight>
            <parameter id="treeModel.rootHeight"/>
        </rootHeight>
        <nodeHeights internalNodes="true">
            <parameter id="treeModel.internalNodeHeights"/>
        </nodeHeights>
        <nodeHeights internalNodes="true" rootNode="true">
            <parameter id="treeModel.allInternalNodeHeights"/>
        </nodeHeights>
        <nodeTraits name="X" rootNode="false" internalNodes="false" leafNodes="true" traitDimension="1">
            <parameter id="leafTraits"/>
        </nodeTraits>
    </treeModel>


    <!-- HKY -->

    <hkyModel id="hky85">
        <frequencies>
            <frequencyModel id='frequencies1' dataType="nucleotide">
                <frequencies>
                    <parameter dimension="4" value="0.1 0.3 0.2 0.4"/>
                </frequencies>
            </frequencyModel>
        </frequencies>
        <kappa>
            <parameter id="hky85.kappa" value="1.0" lower="0.0" upper="100.0"/>
        </kappa>
    </hkyModel>

    <siteModel id="siteModel3">
        <substitutionModel>
            <hkyModel idref="hky85"/>
        </substitutionModel>
        <mutationRate>
            <parameter id="siteModel3.mu" value="1.0" lower="0.0"/>
        </mutationRate>
    </siteModel>

    <treeLikelihood id="treeLikelihood3">
        <patterns idref="patterns1"/>
        <treeModel idref="treeModel"/>
        <siteModel idref="siteModel3"/>
    </treeLikelihood>

    <report>
        HKY85:
        ln L =
        <treeLikelihood idref="treeLikelihood3"/>
        (R = -19.25650498361634)

    </report>



    <multivariateDiffusionModel id="diffusionModel">
        <precisionMatrix>
            <matrixParameter id="precisionMatrix">
                <parameter id="prec.col1" value="2.0"/>
            </matrixParameter>
        </precisionMatrix>
    </multivariateDiffusionModel>

    <arbitraryBranchRates id="branchRates" reciprocal="false" exp="true" centerAtOne="false">
        <rates>
            <parameter id="actual.rates" value="4 3 2 1" lower="0"/>
        </rates>
        <treeModel idref="treeModel"/>
    </arbitraryBranchRates>

    <traitDataLikelihood id="scalarLikelihood" traitName="X" forceFullPrecision="false">
        <multivariateDiffusionModel idref="diffusionModel"/>
        <treeModel idref="treeModel"/>
        <traitParameter>
            <parameter idref="leafTraits"/>
        </traitParameter>
        <arbitraryBranchRates idref="branchRates"/>
        <conjugateRootPrior>
            <meanParameter>
                <parameter value="0.0"/>
            </meanParameter>
            <priorSampleSize>
                <parameter value="0.000001"/>
            </priorSampleSize>
        </conjugateRootPrior>
    </traitDataLikelihood>

    <report>
        Scalar precision =
        <traitDataLikelihood idref="scalarLikelihood"/>
    </report>

    <branchRateGradient id="branchRateGradientScalar" traitName="X">
        <traitDataLikelihood idref="scalarLikelihood"/>
    </branchRateGradient>

    <!--<report>-->
        <!--<traitLogger traitName="bcd.X" nodes="external">-->
            <!--<traitDataLikelihood idref="scalarLikelihood"/>-->
            <!--<treeModel idref="treeModel"/>-->
        <!--</traitLogger>-->
    <!--</report>-->

    <!--<report>-->
        <!--<branchRateGradient idref="branchRateGradientScalar"/>-->
    <!--</report>-->

    <arbitraryBranchRates id="branchRatesDiscrete" reciprocal="false" exp="false" centerAtOne="false">
        <rates>
            <parameter id="strict.clock.rates" value="1.0" lower="0"/>
        </rates>
        <treeModel idref="treeModel"/>
    </arbitraryBranchRates>

    <!-- Likelihood for tree given sequence data                                 -->
    <treeDataLikelihood id="treeLikelihood" useAmbiguities="false" usePreOrder="true">
        <patterns idref="patterns1"/>
        <treeModel idref="treeModel"/>
        <siteModel idref="siteModel3"/>
        <arbitraryBranchRates idref="branchRatesDiscrete"/>
    </treeDataLikelihood>

    <!--<report>-->
        <!--HKY85:-->
        <!--ln L =-->
        <!--<treeDataLikelihood idref="treeLikelihood"/>-->
        <!--(R = -19.25650498361634)-->

    <!--</report>-->

    <branchRateGradient id="branchRateGradientDiscreteTrait" traitName="Sequence">
        <treeDataLikelihood idref="treeLikelihood"/>
    </branchRateGradient>

    <!--<report>-->
        <!--<traitLogger traitName="derivative.Sequence" nodes="external">-->
            <!--<treeDataLikelihood idref="treeLikelihood"/>-->
            <!--<treeModel idref="treeModel"/>-->
        <!--</traitLogger>-->
    <!--</report>-->

    <report>
        <branchRateGradient idref="branchRateGradientDiscreteTrait"/>
    </report>


</beast>

<!--
# R script
library(mvtnorm)

-->
