<?xml version="1.0" standalone="yes"?>
<beast>

    <taxa id="taxa">
        <taxon id="t24"> <attr name="simTrait"> 2.8596198 -0.787363687  4.95641407 -0.443534524 </attr> </taxon>
        <taxon id="t43"> <attr name="simTrait"> 1.6614194 -1.569239440  4.81716395  0.130572129 </attr> </taxon>
        <taxon id="t16"> <attr name="simTrait"> 2.5275275 -0.263548128  1.68580495  1.714283151 </attr> </taxon>
        <taxon id="t62"> <attr name="simTrait"> 2.6522297 -0.775504036  0.87312240  0.995633986 </attr> </taxon>
        <taxon id="t64"> <attr name="simTrait"> 1.7542803 -0.035791495 -1.01059146  1.646196943 </attr> </taxon>
        <taxon id="t20"> <attr name="simTrait"> 1.4431892 -0.422356676 -1.02093342  2.340777438 </attr> </taxon>
        <taxon id="t14"> <attr name="simTrait"> 3.6473853 -0.332734294  1.82129613 -0.230827419 </attr> </taxon>
        <taxon id="t99"> <attr name="simTrait"> 3.4529830 -0.542700438  0.32622717  1.762616954 </attr> </taxon>
        <taxon id="t80"> <attr name="simTrait"> 4.7690480 -3.451171638  0.33350550  2.047907156 </attr> </taxon>
        <taxon id="t97"> <attr name="simTrait"> 6.0488089 -3.763315604 -1.09604557  0.725704793 </attr> </taxon>
        <taxon id="t33"> <attr name="simTrait"> 5.7894959 -1.859241306  1.45974480  4.824691493 </attr> </taxon>
        <taxon id="t22"> <attr name="simTrait"> 4.8734202 -2.833798140 -2.40136312  3.939595755 </attr> </taxon>
        <taxon id="t30"> <attr name="simTrait"> 4.8043820 -0.451016466  0.42953944  3.913500830 </attr> </taxon>
        <taxon id="t19"> <attr name="simTrait"> 5.6553361 -1.351298673 -4.52143887 -1.005507104 </attr> </taxon>
        <taxon id="t37"> <attr name="simTrait"> 3.9416741 -1.795557715 -3.63294434  0.288649496 </attr> </taxon>
        <taxon id="t1"> <attr name="simTrait">  6.0856468  0.740964701 -3.55928612  1.738824566 </attr> </taxon>
        <taxon id="t35"> <attr name="simTrait"> 6.1597676  0.248351281 -4.42216435  1.658126061 </attr> </taxon>
        <taxon id="t92"> <attr name="simTrait"> 5.9827633 -0.756151188 -3.49319728  0.227740976 </attr> </taxon>
        <taxon id="t18"> <attr name="simTrait"> 5.1251760 -1.071218778 -1.78523179  1.591301423 </attr> </taxon>
        <taxon id="t50"> <attr name="simTrait"> 2.8049821  2.009689020 -4.12154016  1.586659879 </attr> </taxon>
        <taxon id="t90"> <attr name="simTrait"> 3.7926173  2.355176466 -4.95495197  2.676579151 </attr> </taxon>
        <taxon id="t27"> <attr name="simTrait"> 4.6340404  2.199141538 -4.06192601  2.362414958 </attr> </taxon>
        <taxon id="t96"> <attr name="simTrait"> 6.4122452  1.014049148 -2.28383038  3.713669492 </attr> </taxon>
        <taxon id="t71"> <attr name="simTrait"> 5.3767798  0.725302137 -3.43453345  2.295627298 </attr> </taxon>
        <taxon id="t77"> <attr name="simTrait"> 6.0836355  1.510280353 -2.75088895  1.510085486 </attr> </taxon>
        <taxon id="t98"> <attr name="simTrait"> 3.5000929 -0.302248157 -1.66033406  2.417329122 </attr> </taxon>
        <taxon id="t72"> <attr name="simTrait"> 3.9490185  0.261738455  0.43592294  4.136459182 </attr> </taxon>
        <taxon id="t60"> <attr name="simTrait"> 4.4666463  1.464398711 -2.92634610  4.210489971 </attr> </taxon>
        <taxon id="t73"> <attr name="simTrait"> 4.5769806  0.004327069 -1.41764229  5.193897387 </attr> </taxon>
        <taxon id="t46"> <attr name="simTrait"> 5.5570612  1.567262450 -1.39940578  5.139352688 </attr> </taxon>
        <taxon id="t82"> <attr name="simTrait"> 4.9802239  2.645073451 -3.57240249  3.641206223 </attr> </taxon>
        <taxon id="t12"> <attr name="simTrait"> 5.9174200  1.728297951 -4.97905150  3.731458421 </attr> </taxon>
        <taxon id="t23"> <attr name="simTrait"> 5.3057360  0.140896200 -2.21711754 -1.473544335 </attr> </taxon>
        <taxon id="t94"> <attr name="simTrait"> 4.8842420  1.604216491 -0.30818670 -1.632867439 </attr> </taxon>
        <taxon id="t78"> <attr name="simTrait"> 4.9664813  1.527710185  0.22058263  0.667619421 </attr> </taxon>
        <taxon id="t36"> <attr name="simTrait"> 6.2963446  2.893771649  2.07541578  2.586269212 </attr> </taxon>
        <taxon id="t49"> <attr name="simTrait"> 6.2040295  1.287947713  0.74017154  0.779736325 </attr> </taxon>
        <taxon id="t54"> <attr name="simTrait"> 2.7345436  1.905322272 -0.07592357 -0.962722973 </attr> </taxon>
        <taxon id="t15"> <attr name="simTrait"> 2.2043231  1.834852981 -1.79012847 -0.911719188 </attr> </taxon>
        <taxon id="t17"> <attr name="simTrait"> 3.3986461  1.887610185  0.20345487 -2.368757060 </attr> </taxon>
        <taxon id="t4"> <attr name="simTrait">  4.5881986 -1.376205792 -3.71051527 -3.558713346 </attr> </taxon>
        <taxon id="t55"> <attr name="simTrait"> 4.4350013  0.012094836 -2.57499315 -2.302885446 </attr> </taxon>
        <taxon id="t59"> <attr name="simTrait"> 5.1859685 -0.478476223  0.40836194 -0.308532229 </attr> </taxon>
        <taxon id="t29"> <attr name="simTrait"> 2.5662653 -0.157880785 -3.18757322 -0.493813887 </attr> </taxon>
        <taxon id="t44"> <attr name="simTrait"> 3.4047674  1.008005137 -0.84285995 -0.218985956 </attr> </taxon>
        <taxon id="t85"> <attr name="simTrait"> 3.7768401 -0.816369723  3.08554833  0.015360847 </attr> </taxon>
        <taxon id="t31"> <attr name="simTrait"> 4.5306576 -1.761461696  0.32725115 -0.604369339 </attr> </taxon>
        <taxon id="t87"> <attr name="simTrait"> 3.7664151 -1.800737043  2.29384072 -0.418390483 </attr> </taxon>
        <taxon id="t3"> <attr name="simTrait">  0.7325505  0.071204344  1.05332882 -2.479853573 </attr> </taxon>
        <taxon id="t52"> <attr name="simTrait"> 0.8628426 -2.638633279 -0.46851413 -2.951429264 </attr> </taxon>
        <taxon id="t7"> <attr name="simTrait">  2.1464121  1.100078903  1.53750794 -3.399301732 </attr> </taxon>
        <taxon id="t2"> <attr name="simTrait">  2.5440002  1.768088316  0.88108240 -1.574161927 </attr> </taxon>
        <taxon id="t32"> <attr name="simTrait"> 1.5995402 -0.883972348 -0.21873183 -2.880442250 </attr> </taxon>
        <taxon id="t61"> <attr name="simTrait"> 0.2654439 -0.950230124  0.49892625 -4.151296458 </attr> </taxon>
        <taxon id="t48"> <attr name="simTrait"> 1.6552932  0.956780147 -1.14154806 -6.870981642 </attr> </taxon>
        <taxon id="t91"> <attr name="simTrait"> 1.9319507 -0.532035508  0.60712828 -1.316204913 </attr> </taxon>
        <taxon id="t39"> <attr name="simTrait"> 3.2942285 -2.473859534  4.80234680 -3.523801435 </attr> </taxon>
        <taxon id="t84"> <attr name="simTrait"> 1.5258408 -1.026832821  0.60131156 -2.865323831 </attr> </taxon>
        <taxon id="t51"> <attr name="simTrait"> 3.0019344  0.243979158 -0.67348120  0.125542911 </attr> </taxon>
        <taxon id="t56"> <attr name="simTrait"> 1.8965155 -1.221076531 -1.03479356  0.382376855 </attr> </taxon>
        <taxon id="t95"> <attr name="simTrait"> 1.4489264 -2.146004813  2.87288746  0.381069460 </attr> </taxon>
        <taxon id="t28"> <attr name="simTrait"> 2.0264130 -3.150897310  1.93835977  0.668820108 </attr> </taxon>
        <taxon id="t57"> <attr name="simTrait"> 0.9008157 -2.371169097  2.98543384 -0.209617231 </attr> </taxon>
        <taxon id="t9"> <attr name="simTrait"> -0.6069352  1.426267179 -0.96651992 -0.480463083 </attr> </taxon>
        <taxon id="t10"> <attr name="simTrait">-0.5861668  0.166119569 -0.86901093 -0.776243125 </attr> </taxon>
        <taxon id="t66"> <attr name="simTrait"> 1.4939119 -2.300232250 -1.36511303 -1.292104348 </attr> </taxon>
        <taxon id="t83"> <attr name="simTrait"> 1.8473754 -0.976004184  1.71412674 -2.256536527 </attr> </taxon>
        <taxon id="t38"> <attr name="simTrait"> 2.7251736  1.049653966  0.94851869 -1.572004130 </attr> </taxon>
        <taxon id="t76"> <attr name="simTrait"> 2.3412334  1.155979480  0.78895292 -2.062797092 </attr> </taxon>
        <taxon id="t40"> <attr name="simTrait"> 3.2314760  0.132669728  0.87741602  1.115861332 </attr> </taxon>
        <taxon id="t41"> <attr name="simTrait"> 3.1267530 -1.119058742  0.20455359  1.970744509 </attr> </taxon>
        <taxon id="t81"> <attr name="simTrait"> 3.6452873 -0.209473984  0.37051098  0.275863103 </attr> </taxon>
        <taxon id="t58"> <attr name="simTrait"> 1.6246464  1.617836730  1.55924354  3.839470419 </attr> </taxon>
        <taxon id="t47"> <attr name="simTrait"> 1.9678039  0.955538036  0.53613797  3.386887307 </attr> </taxon>
        <taxon id="t68"> <attr name="simTrait"> 1.4038539  1.209725985  0.06174098  5.475039081 </attr> </taxon>
        <taxon id="t21"> <attr name="simTrait"> 0.9564751  1.449723633  0.87471326  4.199013614 </attr> </taxon>
        <taxon id="t74"> <attr name="simTrait"> 2.2984286  1.312010147  1.01027395  4.153665746 </attr> </taxon>
        <taxon id="t13"> <attr name="simTrait"> 2.4413816  1.092481203  1.89013365 -0.002708461 </attr> </taxon>
        <taxon id="t70"> <attr name="simTrait"> 2.5027301  0.737433950 -1.14178712  1.818392925 </attr> </taxon>
        <taxon id="t65"> <attr name="simTrait"> 2.2232071  1.056924204  1.11201472  1.224154065 </attr> </taxon>
        <taxon id="t67"> <attr name="simTrait"> 1.0930647  0.434481916  3.44563728  4.190481907 </attr> </taxon>
        <taxon id="t75"> <attr name="simTrait"> 3.7356747  3.154663611  3.42059804  3.572794737 </attr> </taxon>
        <taxon id="t69"> <attr name="simTrait"> 2.6781083  0.663468410  2.15220011  2.212195420 </attr> </taxon>
        <taxon id="t25"> <attr name="simTrait"> 2.2621094  1.472294307  4.14270270 -0.622957834 </attr> </taxon>
        <taxon id="t100"> <attr name="simTrait">3.7598724  2.123938858  3.61488324  0.253598902 </attr> </taxon>
        <taxon id="t11"> <attr name="simTrait"> 3.9766012  1.579438172  0.55426117 -0.191017600 </attr> </taxon>
        <taxon id="t5"> <attr name="simTrait">  2.9285284 -1.405440286 -1.11384531  1.409571544 </attr> </taxon>
        <taxon id="t26"> <attr name="simTrait"> 4.7963080 -0.754236723 -0.02921063  0.678104819 </attr> </taxon>
        <taxon id="t88"> <attr name="simTrait"> 3.0954146 -0.062185252  0.83891849 -0.815974182 </attr> </taxon>
        <taxon id="t8"> <attr name="simTrait">  3.4971217  2.761156921 -4.24172466  2.634431530 </attr> </taxon>
        <taxon id="t45"> <attr name="simTrait"> 3.0878106  2.450673827 -1.95162016 -1.359438843 </attr> </taxon>
        <taxon id="t86"> <attr name="simTrait"> 2.7161355  0.807910100 -0.31221966  1.832394048 </attr> </taxon>
        <taxon id="t53"> <attr name="simTrait"> 2.8326143  1.207443703 -0.76457472  1.688557245 </attr> </taxon>
        <taxon id="t79"> <attr name="simTrait"> 4.5319123  2.104917527 -1.33225865 -1.100789676 </attr> </taxon>
        <taxon id="t6"> <attr name="simTrait">  2.7175189  0.709756060 -1.96127121 -2.665024293 </attr> </taxon>
        <taxon id="t89"> <attr name="simTrait"> 2.9152728  0.848990034 -2.37376069 -1.095246782 </attr> </taxon>
        <taxon id="t93"> <attr name="simTrait"> 5.3657802 -1.622711589 -1.11268403  0.673030367 </attr> </taxon>
        <taxon id="t34"> <attr name="simTrait"> 2.8712621 -0.497649645 -1.04157435 -1.132397352 </attr> </taxon>
        <taxon id="t42"> <attr name="simTrait"> 4.2489344  0.446687127 -0.33234124 -3.851801634 </attr> </taxon>
        <taxon id="t63"> <attr name="simTrait"> 3.8216338 -0.041223426 -0.01776399 -2.048224755 </attr> </taxon>
    </taxa>

	<newick id="tree" usingHeights="true" usingDates="false">
        ((((((t24:0.9075302151,t43:0.540005448):0.6700898686,t16:0.7531856978):0.2963431447,(((t62:0.4304054934,(t64:0.9895814452,t20:0.2604495788):0.1874764648):0.7298065515,t14:0.5422567928):0.1932585463,t99:0.1278785435):0.3045832564):0.7282497261,(((((t80:0.2101408029,t97:0.9655222076):0.8013620267,(t33:0.4862331362,t22:0.4903757197):0.8219450894):0.5950487959,t30:0.2153190481):0.9490912196,((((t19:0.2103033294,t37:0.6535775054):0.5181591073,((t1:0.1292250124,(t35:0.4862269263,t92:0.2220423676):0.1311405459):0.9095605342,t18:0.3931723093):0.0770961768):0.6510230415,((t50:0.844767367,(t90:0.3206227669,t27:0.1929969802):0.4575119058):0.04744261527,t96:0.9816608066):0.3416157677):0.317922994,((t71:0.1143644848,t77:0.846474681):0.6662698365,((((t98:0.2782261258,t72:0.4977792369):0.5075600646,t60:0.3117785591):0.0509823889,t73:0.6175233743):0.4261492991,(t46:0.5690921277,(t82:0.08278519684,t12:0.4812248135):0.08734078798):0.6719293015):0.7969207321):0.141062102):0.9302127464):0.4296891424,(((t23:0.5721048005,t94:0.996998755):0.06248691236,((t78:0.05066431337,(t36:0.1376882682,t49:0.9208129784):0.6240074746):0.4409414225,((t54:0.1253659031,t15:0.1713895439):0.7902247934,t17:0.6401210672):0.9794688707):0.7296229682):0.3314222,(((t4:0.933433417,t55:0.4349851138):0.1984750421,t59:0.7138984192):0.4944749305,(t29:0.9565055349,t44:0.09328538761):0.9037262425):0.7431125732):0.6409307204):0.5864596961):0.8297144896,(((t85:0.4085952907,(t31:0.355502208,t87:0.4349505773):0.4474452443):0.3508421134,((((t3:0.1863645336,t52:0.333365713):0.6965093224,(t7:0.01125796209,(t2:0.3951955943,((t32:0.5887398862,t61:0.4125331012):0.7746168745,t48:0.6501164611):0.0237672946):0.9880839088):0.4861210838):0.4144334132,(t91:0.488070993,t39:0.5683839633):0.2840175752):0.4371991933,((t84:0.2579294983,t51:0.7264498):0.6098172353,((t56:0.2143052609,((t95:0.2016788572,(t28:0.08603072469,t57:0.3589660279):0.5412703049):0.7550056905,(t9:0.9921379744,t10:0.4433793204):0.6765947212):0.2656235343):0.9773819007,t66:0.615537791):0.7748431051):0.2592567136):0.1970710186):0.6830584211,((((((t83:0.595697992,t38:0.3071750065):0.5774715405,(t76:0.8796683406,(t40:0.06201087544,t41:0.1534981653):0.2920607754):0.2512607956):0.04374090466,(t81:0.1655955636,((t58:0.7085649804,(t47:0.256254914,(t68:0.1289083851,t21:0.2845435871):0.3139762923):0.06894414825):0.8959852841,(t74:0.2132541642,t13:0.5541000457):0.5460181874):0.4740783127):0.1439793371):0.7099224646,(t70:0.702626673,t65:0.5275904292):0.625811703):0.5747903467,(((t67:0.7705966204,t75:0.913705671):0.9646819092,t69:0.03436122416):0.612283122,(t25:0.3782430585,t100:0.6719769293):0.9497357663):0.1085641682):0.6970436452,t11:0.4727930094):0.07086141268):0.5138444842):0.4045466094,(((t5:0.3103423782,t26:0.2467847362):0.3506577662,t88:0.4150158686):0.08880821266,(((((t8:0.1135958799,t45:0.5915183316):0.7723709187,(t86:0.1676145224,t53:0.005585279083):0.3699887784):0.8391522861,t79:0.5176667119):0.6555724102,(t6:0.4190019437,t89:0.8136757112):0.2319244056):0.005548706278,(t93:0.6112385388,(t34:0.6709528125,(t42:0.388765781,t63:0.2555863224):0.7560364543):0.9257269145):0.3526448831):0.1675141102):0.887876471);
    </newick>

	<treeModel id="treeModel">
		<newick idref="tree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
		<nodeTraits name="simTrait" rootNode="false" internalNodes="false" leafNodes="true" traitDimension="4">
			<parameter id="leafTraits"/>
		</nodeTraits>
	</treeModel>

    <multivariateDiffusionModel id="diffusionModel">
        <precisionMatrix>
            <compoundSymmetricMatrix id="precisionMatrix" asCorrelation="true" isCholesky="true">
                <diagonal>
                    <parameter id="precision.diagonal" value="1.0102367 0.5036819 0.3351120 0.2510382" lower="0.0 0.0 0.0 0.0"/>
                </diagonal>
                <offDiagonal>
                    <parameter id="precision.correlation" value="-0.06698539 -0.05380454 -0.04622504 -0.03978800 -0.03418303 -0.02881977" />
                </offDiagonal>
            </compoundSymmetricMatrix>
        </precisionMatrix>
	</multivariateDiffusionModel>

	<diagonalMatrix id="attenuation.matrix">
		<parameter id="attenuation.diagonal" value="0.1 0.2 0.3 0.4" lower="0 0 0 0"/>
	</diagonalMatrix>

    <traitDataLikelihood id="ouLikelihood" traitName="simTrait" forceFullPrecision="true">
        <multivariateDiffusionModel idref="diffusionModel"/>
        <treeModel idref="treeModel"/>
        <traitParameter>
            <parameter idref="leafTraits"/>
        </traitParameter>
        <conjugateRootPrior>
            <meanParameter>
                <compoundParameter id="meanRoot">
                    <parameter id="opt.1" value="1.0"/>
                    <parameter id="opt.2" value="2.0"/>
                    <parameter id="opt.3" value="-1.0"/>
                    <parameter id="opt.4" value="-2.0"/>
                </compoundParameter>
            </meanParameter>
            <priorSampleSize>
                <parameter id="sampleSizeRoot" value="2.0"/>
            </priorSampleSize>
        </conjugateRootPrior>
        <optimalTraits id="opt">
            <strictClockBranchRates>
                <rate>
                    <parameter idref="opt.1"/>
                </rate>
            </strictClockBranchRates>
            <strictClockBranchRates>
                <rate>
                    <parameter idref="opt.2"/>
                </rate>
            </strictClockBranchRates>
            <strictClockBranchRates>
                <rate>
                    <parameter idref="opt.3"/>
                </rate>
            </strictClockBranchRates>
            <strictClockBranchRates>
                <rate>
                    <parameter idref="opt.4"/>
                </rate>
            </strictClockBranchRates>
        </optimalTraits>
        <strengthOfSelectionMatrix>
            <matrixParameter idref="attenuation.matrix"/>
        </strengthOfSelectionMatrix>
    </traitDataLikelihood>

    <!-- ************************************************** -->
    <!-- Attenuation -->

    <attenuationGradient id="attenuationDiagonalGradient" parameter="diagonal" traitName="simTrait">
        <traitDataLikelihood idref="ouLikelihood"/>
        <compoundSymmetricMatrix idref="attenuation.matrix"/>
    </attenuationGradient>

    <report>
        <compoundGradient idref="attenuationDiagonalGradient"/>
    </report>

    <halfNormalPrior id="attenuation.diagonal.prior" mean="0" stdev="7.07306">
        <parameter idref="attenuation.diagonal"/>
    </halfNormalPrior>

	<operators id="ouOperators.diagonalAttenuation.hmcVanilla">
 		<hamiltonianMonteCarloOperator weight="1" nSteps="10" stepSize="0.01" mode="vanilla"
                                       drawVariance="1.0" gradientCheckCount="100" gradientCheckTolerance="0.5">
            <jointGradient>
                <gradient>
                    <distributionLikelihood idref="attenuation.diagonal.prior"/>
                    <parameter idref="attenuation.diagonal"/>
                </gradient>
                <gradient idref="attenuationDiagonalGradient"/>
            </jointGradient>
			<parameter idref="attenuation.diagonal"/>
            <transform type="log"/>
 		</hamiltonianMonteCarloOperator>
	</operators>

	<operators id="ouOperators.diagonalAttenuation.randomWalk">
        <randomWalkOperator windowSize="1.0" weight="1">
            <parameter idref="attenuation.diagonal"/>
        </randomWalkOperator>
	</operators>

	<mcmc id="mcmc.diagonalAttenuation.hmcVanilla" chainLength="5000" autoOptimize="false">
		<posterior>
            <prior>
                <halfNormalPrior idref="attenuation.diagonal.prior"/>
            </prior>
            <likelihood id="likelihood.diagonalAttenuation.hmcVanilla">
                <traitDataLikelihood idref="ouLikelihood"/>
            </likelihood>
		</posterior>
		<operators idref="ouOperators.diagonalAttenuation.hmcVanilla"/>
		<log logEvery="100">
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood.diagonalAttenuation.hmcVanilla"/>
			</column>
			<column label="attenuation" dp="4" width="12">
                <parameter idref="attenuation.diagonal"/>
			</column>
		</log>
		<log logEvery="10" fileName="testOUDIffusionAttenuationDiagonalHmcVanilla.log">
            <likelihood idref="likelihood.diagonalAttenuation.hmcVanilla"/>
            <matrixParameter idref="attenuation.diagonal"/>
		</log>
	</mcmc>

	<mcmc id="mcmc.diagonalAttenuation.randomWalk" chainLength="100000" autoOptimize="false">
		<posterior>
            <prior>
                <halfNormalPrior idref="attenuation.diagonal.prior"/>
            </prior>
            <likelihood id="likelihood.diagonalAttenuation.randomWalk">
                <traitDataLikelihood idref="ouLikelihood"/>
            </likelihood>
		</posterior>
		<operators idref="ouOperators.diagonalAttenuation.randomWalk"/>
		<log logEvery="1000">
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood.diagonalAttenuation.randomWalk"/>
			</column>
			<column label="attenuation" dp="4" width="12">
                <parameter idref="attenuation.diagonal"/>
			</column>
		</log>
		<log logEvery="100" fileName="testOUDIffusionAttenuationDiagonalRandomWalk.log">
            <likelihood idref="likelihood.diagonalAttenuation.randomWalk"/>
            <matrixParameter idref="attenuation.diagonal"/>
		</log>
	</mcmc>

	<report>
		<property name="timer">
			<object idref="mcmc.diagonalAttenuation.randomWalk"/>
		</property>
	</report>

	<traceAnalysis fileName="testOUDIffusionAttenuationDiagonalRandomWalk.log" stdError="true"/>
	
	<report>
		<property name="timer">
			<object idref="mcmc.diagonalAttenuation.hmcVanilla"/>
		</property>
	</report>
	
	<traceAnalysis fileName="testOUDIffusionAttenuationDiagonalHmcVanilla.log" stdError="true"/>

    <!-- <maximizeWrtParameter id="maximize.diagonalAttenuation"  nIteration="100" printToScreen="true"> -->
        <!-- <densityWrtParameter> -->
            <!-- <traitDataLikelihood idref="ouLikelihood"/> -->
            <!-- <parameter idref="attenuation.diagonal"/> -->
        <!-- </densityWrtParameter> -->
    <!-- </maximizeWrtParameter> -->

    <!-- <report> -->
        <!-- <maximizeWrtParameter idref="maximize.diagonalAttenuation"/> --> 
    <!-- </report> -->

<!--
burnIn   <= 10000,   maxState  = 100000
statistic   mean    stdErr  median  hpdLower    hpdUpper    ESS 50hpdLower  50hpdUpper
likelihood.diagonalAttenuation.randomWalk   -688.359    1.1727  -688.0883   -690.5509   -686.7456   901 -688.2329   -687.0087   
attenuation.diagonal1   0.0549  0.0361  0.0486  5.6858E-5   0.1215  901 0.0113  0.0574  
attenuation.diagonal2   0.1612  0.0691  0.1599  0.02    0.28    890.1344    0.1072  0.2078  
attenuation.diagonal3   0.2097  0.0853  0.2107  0.0447  0.3691  901 0.1579  0.2757  
attenuation.diagonal4   0.1933  0.0668  0.1971  0.0602  0.3162  901 0.1459  0.234   

burnIn   <= 500,   maxState  = 5000
statistic   mean    stdErr  median  hpdLower    hpdUpper    ESS 50hpdLower  50hpdUpper
likelihood.diagonalAttenuation.hmcVanilla   -688.306    1.1944  -688.0196   -690.6438   -686.8417   376.0741    -688.042    -686.8417   
attenuation.diagonal1   0.0541  0.034   0.0515  2.1982E-4   0.1174  451 0.0182  0.0645  
attenuation.diagonal2   0.1639  0.0681  0.1643  0.0416  0.2798  319.8053    0.1095  0.2071  
attenuation.diagonal3   0.2168  0.0852  0.2151  0.0562  0.3789  316.4935    0.1539  0.2628  
attenuation.diagonal4   0.1908  0.066   0.1927  0.0533  0.2996  267.1624    0.1598  0.2509

X: [ 0.033394320144921844, 0.1637186636208327, 0.20851782773214472, 0.1949744758261829]
Gradient: [ -7.382849298204062E-6, -6.556047238695691E-6, 5.366065111122075E-5, 6.384566938950876E-6]
Gradient type: numerical
Fx: 686.6735007065741
Time: 0.363s
Count: 450
-->


    <!-- ************************************************** -->
    <!-- Optima -->

    <meanGradient id="meanGradient" parameter="opt" traitName="simTrait">
        <traitDataLikelihood idref="ouLikelihood"/>
        <parameter idref="meanRoot"/>
    </meanGradient>

    <report>
        <compoundGradient idref="meanGradient"/>
    </report>

    <normalPrior id="meanRoot.prior" mean="0" stdev="5">
        <parameter idref="meanRoot"/>
    </normalPrior>

	<operators id="ouOperators.meanRoot.hmcVanilla">
 		<hamiltonianMonteCarloOperator weight="1" nSteps="10" stepSize="0.01" mode="vanilla"
                                       drawVariance="1.0" gradientCheckCount="100" gradientCheckTolerance="0.5">
            <jointGradient>
                <gradient>
                    <distributionLikelihood idref="meanRoot.prior"/>
                    <parameter idref="meanRoot"/>
                </gradient>
                <gradient idref="meanGradient"/>
            </jointGradient>
			<parameter idref="meanRoot"/>
 		</hamiltonianMonteCarloOperator>
	</operators>

	<operators id="ouOperators.meanRoot.randomWalk">
        <randomWalkOperator windowSize="1.0" weight="1">
            <parameter idref="meanRoot"/>
        </randomWalkOperator>
	</operators>

	<mcmc id="mcmc.meanRoot.hmcVanilla" chainLength="5000" autoOptimize="false">
		<posterior>
            <prior>
                <normalPrior idref="meanRoot.prior"/>
            </prior>
            <likelihood id="likelihood.meanRoot.hmcVanilla">
                <traitDataLikelihood idref="ouLikelihood"/>
            </likelihood>
		</posterior>
		<operators idref="ouOperators.meanRoot.hmcVanilla"/>
		<log logEvery="100">
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood.meanRoot.hmcVanilla"/>
			</column>
			<column label="opt" dp="4" width="12">
                <parameter idref="meanRoot"/>
			</column>
		</log>
		<log logEvery="10" fileName="testOUDIffusionMeanRootHmcVanilla.log">
            <likelihood idref="likelihood.meanRoot.hmcVanilla"/>
            <matrixParameter idref="meanRoot"/>
		</log>
	</mcmc>

	<mcmc id="mcmc.meanRoot.randomWalk" chainLength="100000" autoOptimize="false">
		<posterior>
            <prior>
                <normalPrior idref="meanRoot.prior"/>
            </prior>
            <likelihood id="likelihood.meanRoot.randomWalk">
                <traitDataLikelihood idref="ouLikelihood"/>
            </likelihood>
		</posterior>
		<operators idref="ouOperators.meanRoot.randomWalk"/>
		<log logEvery="1000">
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood.meanRoot.randomWalk"/>
			</column>
			<column label="opt" dp="4" width="12">
                <parameter idref="meanRoot"/>
			</column>
		</log>
		<log logEvery="100" fileName="testOUDIffusionMeanRootRandomWalk.log">
            <likelihood idref="likelihood.meanRoot.randomWalk"/>
            <matrixParameter idref="meanRoot"/>
		</log>
	</mcmc>

	<report>
		<property name="timer">
			<object idref="mcmc.meanRoot.randomWalk"/>
		</property>
	</report>

	<traceAnalysis fileName="testOUDIffusionMeanRootRandomWalk.log" stdError="true"/>
	
	<report>
		<property name="timer">
			<object idref="mcmc.meanRoot.hmcVanilla"/>
		</property>
	</report>
	
	<traceAnalysis fileName="testOUDIffusionMeanRootHmcVanilla.log" stdError="true"/>

    <!-- <maximizeWrtParameter id="maximize.meanRoot"  nIteration="100" printToScreen="true"> -->
        <!-- <densityWrtParameter> -->
            <!-- <traitDataLikelihood idref="ouLikelihood"/> -->
            <!-- <parameter idref="meanRoot"/> -->
        <!-- </densityWrtParameter> -->
    <!-- </maximizeWrtParameter> -->

    <!-- <report> -->
        <!-- <maximizeWrtParameter idref="maximize.meanRoot"/> --> 
    <!-- </report> -->

<!--
burnIn   <= 10000,   maxState  = 100000
statistic   mean    stdErr  median  hpdLower    hpdUpper    ESS 50hpdLower  50hpdUpper
likelihood.meanRoot.randomWalk  -679.3486   1.3608  -679.0512   -682.0161   -677.4935   901 -679.2988   -677.8913   
opt.1   2.846   0.6913  2.8301  1.5955  4.2513  657.6681    2.4716  3.3738  
opt.2   -0.0521 0.7295  -0.0209 -1.5217 1.2657  901 -0.3576 0.6262  
opt.3   -0.1205 0.641   -0.0817 -1.4452 1.0052  901 -0.514  0.3365  
opt.4   0.2363  0.5807  0.2405  -0.8758 1.3585  901 -0.1534 0.6041  

burnIn   <= 500,   maxState  = 5000
statistic   mean    stdErr  median  hpdLower    hpdUpper    ESS 50hpdLower  50hpdUpper
likelihood.meanRoot.hmcVanilla  -679.3871   1.3862  -679.0579   -681.9634   -677.5091   399.7119    -679.2436   -677.871    
opt.1   2.9074  0.7212  2.903   1.5664  4.1725  268.8913    2.3514  3.3356  
opt.2   -0.0332 0.7224  -0.0187 -1.3528 1.4292  451 -0.4528 0.4468  
opt.3   -0.1283 0.6505  -0.1288 -1.414  1.1253  451 -0.6012 0.2198  
opt.4   0.2525  0.5819  0.2461  -0.8795 1.396   365.0651    -0.184  0.5993  

X: [ 2.903709111492328, 0.0018041112396677728, -0.098598294574799, 0.24466909674874276]
Gradient: [ 7.81758508469746E-6, 1.1423482563585885E-5, 1.04169939580184E-5, 3.0648284556831573E-6]
Gradient type: numerical
Fx: 677.4352424945262
Time: 0.059s
Count: 72
-->

    <!-- ************************************************** -->
    <!-- Compound Attenuation Precision Opt -->

    <precisionGradient id="precisionDiagonalGradientPreOrder" parameter="both" traitName="simTrait">
        <traitDataLikelihood idref="ouLikelihood"/>
        <compoundSymmetricMatrix idref="precisionMatrix"/>
    </precisionGradient>

    <report>
        <precisionGradient idref="precisionDiagonalGradientPreOrder"/>
    </report>

    <diffusionGradient id="allGradient">
        <precisionGradient parameter="both" traitName="simTrait">
            <traitDataLikelihood idref="ouLikelihood"/>
            <compoundSymmetricMatrix idref="precisionMatrix"/>
        </precisionGradient>
        <attenuationGradient parameter="diagonal" traitName="simTrait">
            <traitDataLikelihood idref="ouLikelihood"/>
            <compoundSymmetricMatrix idref="attenuation.matrix"/>
        </attenuationGradient>
        <meanGradient parameter="opt" traitName="simTrait">
            <traitDataLikelihood idref="ouLikelihood"/>
            <parameter idref="meanRoot"/>
        </meanGradient>
    </diffusionGradient>

    <compoundGradient id="allCompoundGradient">
        <precisionGradient parameter="both" traitName="simTrait">
            <traitDataLikelihood idref="ouLikelihood"/>
            <compoundSymmetricMatrix idref="precisionMatrix"/>
        </precisionGradient>
        <attenuationGradient parameter="diagonal" traitName="simTrait">
            <traitDataLikelihood idref="ouLikelihood"/>
            <compoundSymmetricMatrix idref="attenuation.matrix"/>
        </attenuationGradient>
        <meanGradient parameter="opt" traitName="simTrait">
            <traitDataLikelihood idref="ouLikelihood"/>
            <parameter idref="meanRoot"/>
        </meanGradient>
    </compoundGradient>

    <report>
        <compoundGradient idref="allCompoundGradient"/>
    </report>

    <report>
        <diffusionGradient idref="allGradient"/>
    </report>

    <logNormalPrior id="prior.diagonal" mean="0.0" stdev="1.0" offset="0.0" meanInRealSpace="false">
        <parameter idref="precision.diagonal"/>
    </logNormalPrior>

    <LKJCorrelationPrior id="prior.cholesky" shapeParameter="1.0" dimension="4">
        <data>
            <parameter idref="precision.correlation"/>
        </data>
    </LKJCorrelationPrior>

    <compoundGradient id="priorGradient">
        <gradient>
            <logNormalPrior idref="prior.diagonal"/>
            <parameter idref="precision.diagonal"/>
        </gradient>
        <gradient>
            <LKJCorrelationPrior idref="prior.cholesky"/>
        </gradient>
        <gradient>
            <distributionLikelihood idref="attenuation.diagonal.prior"/>
            <parameter idref="attenuation.diagonal"/>
        </gradient>
        <gradient>
            <distributionLikelihood idref="meanRoot.prior"/>
            <parameter idref="meanRoot"/>
        </gradient>
    </compoundGradient>

	<operators id="ouOperators.compoundDiagonalAttenuationPrecision.hmcVanilla">
 		<hamiltonianMonteCarloOperator weight="1" nSteps="10" stepSize="0.01" mode="vanilla"
                                       drawVariance="1.0" gradientCheckCount="100" gradientCheckTolerance="0.1">
            <jointGradient id="post.precisionBothGradient">
                <diffusionGradient idref="allGradient"/>
                <!-- <compoundGradient idref="allCompoundGradient"/> -->
                <compoundGradient idref="priorGradient"/>
            </jointGradient>
            <compoundParameter id="attenuation.precision.diagonal">
                <parameter idref="precision.diagonal"/>
                <parameter idref="precision.correlation"/>
                <parameter idref="attenuation.diagonal"/>
                <parameter idref="meanRoot"/>
            </compoundParameter>
            <multivariateCompoundTransform>
                <transform type="log" dim="4"/>
                <LKJTransform dimension="4"/>
                <transform type="log" dim="4"/>
                <transform type="none" dim="4"/>
            </multivariateCompoundTransform>
 		</hamiltonianMonteCarloOperator>
	</operators>

	<operators id="ouOperators.compoundDiagonalAttenuationPrecision.randomWalk">
        <randomWalkOperator windowSize="1.0" weight="1">
            <parameter idref="precision.diagonal"/>
        </randomWalkOperator>
        <randomWalkOperator windowSize="1.0" weight="1">
            <parameter idref="precision.correlation"/>
            <LKJTransform dimension = "4"/>
        </randomWalkOperator>
        <randomWalkOperator windowSize="1.0" weight="1">
            <parameter idref="attenuation.diagonal"/>
        </randomWalkOperator>
        <randomWalkOperator windowSize="1.0" weight="1">
            <parameter idref="meanRoot"/>
        </randomWalkOperator>
	</operators>

	<mcmc id="mcmc.compoundDiagonalAttenuationPrecision.hmcVanilla" chainLength="5000" autoOptimize="false">
		<posterior>
            <prior>
                <logNormalPrior idref="prior.diagonal"/>
                <LKJCorrelationPrior idref="prior.cholesky"/>
                <halfNormalPrior idref="attenuation.diagonal.prior"/>
                <normalPrior idref="meanRoot.prior"/>
            </prior>
            <likelihood id="likelihood.compoundDiagonalAttenuationPrecision.hmcVanilla">
                <traitDataLikelihood idref="ouLikelihood"/>
            </likelihood>
		</posterior>
		<operators idref="ouOperators.compoundDiagonalAttenuationPrecision.hmcVanilla"/>

		<log logEvery="100">
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood.compoundDiagonalAttenuationPrecision.hmcVanilla"/>
			</column>
			<column label="attenuation" dp="4" width="12">
                <parameter idref="attenuation.diagonal"/>
			</column>
			<column label="precision" dp="4" width="12">
                <matrixParameter idref="precisionMatrix"/>
			</column>
			<column label="opt" dp="4" width="12">
                <parameter idref="meanRoot"/>
			</column>
		</log>
		<log logEvery="10" fileName="testOUDIffusionAttenuationPrecisionDiagonalHmcVanilla.log">
            <likelihood idref="likelihood.compoundDiagonalAttenuationPrecision.hmcVanilla"/>
            <matrixParameter idref="precision.diagonal"/>
            <matrixParameter idref="precision.correlation"/>
            <matrixParameter idref="attenuation.diagonal"/>
            <parameter idref="meanRoot"/>
		</log>
	</mcmc>

	<mcmc id="mcmc.compoundDiagonalAttenuationPrecision.randomWalk" chainLength="100000" autoOptimize="false">
		<posterior>
            <prior>
                <logNormalPrior idref="prior.diagonal"/>
                <LKJCorrelationPrior idref="prior.cholesky"/>
                <halfNormalPrior idref="attenuation.diagonal.prior"/>
                <normalPrior idref="meanRoot.prior"/>
            </prior>
            <likelihood id="likelihood.compoundDiagonalAttenuationPrecision.randomWalk">
                <traitDataLikelihood idref="ouLikelihood"/>
            </likelihood>
		</posterior>
		<operators idref="ouOperators.compoundDiagonalAttenuationPrecision.randomWalk"/>

		<log logEvery="1000">
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood.compoundDiagonalAttenuationPrecision.randomWalk"/>
			</column>
			<column label="attenuation" dp="4" width="12">
                <parameter idref="attenuation.diagonal"/>
			</column>
			<column label="precision" dp="4" width="12">
                <matrixParameter idref="precisionMatrix"/>
			</column>
			<column label="opt" dp="4" width="12">
                <parameter idref="meanRoot"/>
			</column>
		</log>
		<log logEvery="100" fileName="testOUDIffusionAttenuationPrecisionDiagonalRandomWalk.log">
            <likelihood idref="likelihood.compoundDiagonalAttenuationPrecision.randomWalk"/>
            <matrixParameter idref="precision.diagonal"/>
            <matrixParameter idref="precision.correlation"/>
            <matrixParameter idref="attenuation.diagonal"/>
            <parameter idref="meanRoot"/>
		</log>
	</mcmc>

	<report>
		<property name="timer">
			<object idref="mcmc.compoundDiagonalAttenuationPrecision.randomWalk"/>
		</property>
	</report>

	<traceAnalysis fileName="testOUDIffusionAttenuationPrecisionDiagonalRandomWalk.log" stdError="true"/>

	<report>
		<property name="timer">
			<object idref="mcmc.compoundDiagonalAttenuationPrecision.hmcVanilla"/>
		</property>
	</report>
	
	<traceAnalysis fileName="testOUDIffusionAttenuationPrecisionDiagonalHmcVanilla.log" stdError="true"/>

    <!-- <maximizeWrtParameter id="maximize.compoundDiagonalAttenuationPrecision"  nIteration="100" printToScreen="true"> -->
    <!--     <densityWrtParameter> -->
    <!--         <traitDataLikelihood idref="ouLikelihood"/> -->
    <!--         <parameter idref="attenuation.precision.diagonal"/> -->
    <!--     </densityWrtParameter> -->
    <!--     <signTransform> -->
    <!--         <parameter idref="attenuation.precision.diagonal"/> -->
    <!--     </signTransform> -->
    <!-- </maximizeWrtParameter> -->

    <!-- <report> -->
    <!--     <maximizeWrtParameter idref="maximize.compoundDiagonalAttenuationPrecision"/> --> 
    <!-- </report> -->

<!--
burnIn   <= 10000,   maxState  = 100000
statistic   mean    stdErr  median  hpdLower    hpdUpper    ESS 50hpdLower  50hpdUpper
likelihood.compoundDiagonalAttenuationPrecision.randomWalk  -680.5723   2.736   -680.1417   -686.0532   -675.6402   433.2382    -681.24 -677.9618   
precision.diagonal1 1.0478  0.1693  1.0369  0.7323  1.371   463.1221    0.9013  1.1311  
precision.diagonal2 0.6682  0.1149  0.6608  0.4441  0.8858  330.8032    0.5723  0.7194  
precision.diagonal3 0.383   0.0639  0.3807  0.2662  0.5093  345.1963    0.3262  0.4087  
precision.diagonal4 0.3541  0.0617  0.3524  0.2284  0.4771  295.8098    0.3108  0.3872  
precision.correlation1  -0.0005 0.0999  1.4158E-3   -0.1791 0.1895  432.5278    -0.0488 0.0826  
precision.correlation2  -0.0622 0.095   -0.0659 -0.2455 0.1212  445.4616    -0.1261 1.5892E-3   
precision.correlation3  -0.13   0.0994  -0.1297 -0.3123 0.0711  486.4995    -0.1902 -0.0625 
precision.correlation4  1.7492E-3   0.0983  2.7749E-3   -0.1975 0.1826  495.7381    -0.0703 0.0598  
precision.correlation5  -0.0946 0.0896  -0.0901 -0.2811 0.0741  468.7204    -0.1374 -0.0283 
precision.correlation6  -0.0125 0.0972  -0.011  -0.188  0.1809  372.9316    -0.084  0.0425  
attenuation.diagonal1   0.0824  0.0671  0.0649  2.6637E-3   0.216   285.9522    2.6637E-3   0.0649  
attenuation.diagonal2   0.2008  0.1165  0.1886  6.1524E-3   0.417   301.1117    0.0872  0.2377  
attenuation.diagonal3   0.1598  0.098   0.1497  2.0684E-3   0.3432  439.9938    0.0561  0.1805  
attenuation.diagonal4   0.1614  0.1008  0.1459  2.4598E-3   0.3471  259.5651    0.0673  0.1937  
opt.1   3.0184  0.7983  3.0212  1.6106  4.712   569.6443    2.3869  3.3586  
opt.2   -0.0665 0.7252  -0.0984 -1.6818 1.1772  517.7478    -0.5589 0.3252  
opt.3   0.0118  1.0336  9.1777E-3   -1.8096 2.3811  450.1656    -0.7272 0.5675  
opt.4   -0.0065 1.0648  0.036   -2.1942 1.92    608.6347    -0.4818 0.8818  

burnIn   <= 500,   maxState  = 5000
statistic   mean    stdErr  median  hpdLower    hpdUpper    ESS 50hpdLower  50hpdUpper
likelihood.compoundDiagonalAttenuationPrecision.hmcVanilla  -680.8434   2.7131  -680.6626   -685.8316   -675.5692   396.3956    -682.254    -678.8869   
precision.diagonal1 1.0436  0.1659  1.0356  0.7575  1.3866  395.0134    0.9339  1.144   
precision.diagonal2 0.668   0.1227  0.654   0.4322  0.8944  411.7149    0.5314  0.6912  
precision.diagonal3 0.377   0.0632  0.3753  0.2693  0.5105  351.9734    0.3321  0.4103  
precision.diagonal4 0.3499  0.0602  0.3515  0.2468  0.4753  418.459 0.3204  0.4022  
precision.correlation1  -0.0031 0.0976  -0.0035 -0.1754 0.2001  451 -0.071  0.0645  
precision.correlation2  -0.0501 0.1023  -0.0573 -0.2395 0.1486  451 -0.1326 -0.0007 
precision.correlation3  -0.1285 0.0996  -0.1297 -0.3145 0.0521  388.4101    -0.2014 -0.0735 
precision.correlation4  6.5947E-3   0.1092  1.5792E-3   -0.2066 0.198   358.0547    -0.0684 0.073   
precision.correlation5  -0.1018 0.098   -0.1    -0.2707 0.0833  429.6137    -0.1619 -0.0279 
precision.correlation6  -0.001  0.0993  2.6053E-3   -0.1872 0.1795  418.3218    -0.0458 0.0819  
attenuation.diagonal1   0.0723  0.0599  0.0605  2.0415E-5   0.1866  393.686 2.0415E-5   0.0605  
attenuation.diagonal2   0.2092  0.1227  0.1944  0.0273  0.4479  353.835 0.0708  0.2321  
attenuation.diagonal3   0.1603  0.1013  0.1482  5.6872E-4   0.3283  195.1859    0.0113  0.155   
attenuation.diagonal4   0.1722  0.1005  0.161   6.9497E-3   0.3669  393.1595    0.0849  0.2151  
opt.1   3.0024  0.8795  2.9459  1.3268  4.7427  451 2.193   3.2854  
opt.2   -0.0195 0.695   9.2411E-3   -1.2553 1.3679  295.7625    -0.2291 0.598   
opt.3   0.0109  1.0808  1.216E-3    -2.1725 1.9727  451 -0.803  0.4924  
opt.4   0.0369  1.0802  0.1006  -2.1382 1.9144  451 -0.3569 0.9451  
-->

</beast>

